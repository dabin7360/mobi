define("calendar",["zepto"],function calendar(a){var b="calendar",c=b+"Opt",d=b+"-instance",e=function(a,b){this.element=a,this._init(b)};e.prototype={version:"1.0.0",container:null,_init:function(b){var c=this,d=this.element,e=this._getSettings(d),f=e?e:a.fn.calendar.defaults;e=a.extend({},f,b),this._setSettings(d,e),c._renderHandler(),c._bindEventHandler()},_renderHandler:function(){var a=this,b=a.element,c=a._getSettings(b);a._renderContainer();for(var d=new Date(c.startDate),e=d.getFullYear(),f=d.getMonth(),g=0;g<c.rangeMonth;g++)d=new Date(e,f+g),a._renderCalendarPanel(d)},_bindEventHandler:function(){var b=this,c=b.element,d=b._getSettings(c);c.on("click",function(a){b.container.css("display","block")});var e=b.container.find(".jdui_calendar_close");e.on("click",function(a){b.container.css("display","none")}),b.container.on("click","td",function(e){var f=a(this);if(f.hasClass("num")&&!f.hasClass("disabled")){b.container.find("td").removeClass("selected"),f.addClass("selected");var g=a(this).attr("title");b._selectDay(g),"function"==typeof d.selecteCallback&&d.selecteCallback(g),c.trigger("selectedDate",g)}})},_renderContainer:function(){var b=this,c=b.element,d=b._getSettings(c),e=a('<div class="jdui_calendar"></div>'),f=a('<div class="jdui_calendar_hd"><span class="jdui_calendar_title"></span><span class="jdui_calendar_close">关闭</span></div>');f.find(".jdui_calendar_title").text(d.title);var g=a('<div class="jdui_calendar_bd"></div>');e.append(f),e.append(g),a("body").append(e),b.container=e},_renderCalendarPanel:function(b){var c=this,d=c.element,e=c._getSettings(d),f=b.getFullYear(),g=b.getMonth()+1;c.month_day=new Array(31,28+c._leapYear(f),31,30,31,30,31,31,30,31,30,31),c.date_name_week=e.language.weekList;var h=6-e.wday,i=7-e.wday>=7?0:7-e.wday,j=a('<div class="jdui_calendar_panel"></div>'),k=a('<div class="date_hd"></div>').appendTo(j),l=a('<table class="date_table"></table>').appendTo(j),m=a('<div class="date_txt"></div>').appendTo(k);html="<thead><tr>";for(var n=0;7>n;n++)html+="<th class='",n==h?html+=" sat":n==i&&(html+=" sun"),html+="'>",html+=n+1*e.wday<7?c.date_name_week[n+e.wday]:c.date_name_week[n+e.wday-7],html+="</th>";html+="</tr></thead>",html+="<tbody></tbody>",l.html(html);var o=c.container.find(".jdui_calendar_bd");o.append(j),c.dateTxt=m,c.dateTable=l,c.saturday=h,c.sunday=i,c.datePane=j,c.defYear=f,c.defMonth=g,c._renderBody(f,g)},_dayNumOfMonth:function(a,b){var c=new Date(a,b,0);return c.getDate()},_renderBody:function(b,c){var d=this,e=d.element,f=d._getSettings(e);1>c?(b--,c=12):c>12&&(b++,c=1);var g=c,h=c;c--;var i=g-1,j=d._dayNumOfMonth(b,g-1),k=g+1,l=(d._dayNumOfMonth(b,g+1),d._dayNumOfMonth(b,g));d.month_day[1]=28+d._leapYear(b);var m="",n=new Date(b,c,1),o=new Date;o.setHours(0),o.setMinutes(0),o.setSeconds(0);for(var p,q,r,s,t,u=n.getDay()-f.wday<0?n.getDay()-f.wday+7:n.getDay()-f.wday,v=Math.ceil((u+d.month_day[c])/7),w=0;v>w;w++){m+="<tr>";for(var x=0;7>x;x++){if(p=7*w+x,q=p-u+1,0>=q?0==q?(q=j-q,text_m=i):(q=j+q,text_m=i):q>d.month_day[c]?(q-=l,text_m=k):text_m=h,m+="<td","number"==typeof q){r=null,s=null,n=new Date(b,c,q);o.getDate();text_m==h&&(r=Date.parse(o)-Date.parse(n),s=Date.parse(f.selectDate)-Date.parse(n)),h>text_m||h<text_m?(t="disabled",q=""):t="";var y="-";m+=" title='"+b+y+g+y+q+"' class='num "+t,0==s&&(m+=" selected"),0==r?m+=" now":x==d.saturday?m+=" sat":x==d.sunday&&(m+=" sun"),m+="'"}m+=" date-day='"+q+"'>"+q+"</td>"}m+="</tr>"}return a(d.dateTable).find("tbody").html(m),a(d.dateTxt).html("<span class='y'>"+b+"</span>"+f.language.year+"<span class='m'>"+f.language.monthList[c]+"</span>"+f.language.month),this},_leapYear:function(a){return a%4==0&&a%100!=0||a%400==0?1:0},_selectDay:function(b){var c=this,d=c.element,e=b.split("-"),f=e[0],g="0"+e[1],h="0"+e[2];g=g.substr(g.length-2,g.length),h=h.substr(h.length-2,h.length);var i=f+"-"+g+"-"+h;d.text(i),c.callback&&a.isFunction(c.callback)&&c.callback(i)},_getSettings:function(a){return a.data(c)},_setSettings:function(a,b){a.data(c,b)},show:function(){var a=this,b=a.element;b.click()},hide:function(){var a=this;a.container.find(".jdui_calendar_close").click()}};var f={init:function(b){this.each(function(){var c=a(this);c.data(d)||c.data(d,new e(c,b))})},instance:function(){var b=[];return this.each(function(){var c=a(this);b.push(c.data(d))}),b},show:function(){var b=a(this),c=(b.data(d),b.data(d));c&&c.show()},hide:function(){var b=a(this),c=(b.data(d),b.data(d));c&&c.hide()}};return a.fn.calendar=function(){var a=arguments[0];if(f[a]){if(!this.data(d))return void console.log("please init calendar first");a=f[a],arguments=Array.prototype.slice.call(arguments,1)}else{if("object"!=typeof a&&a)return console.log("Method "+a+" does not exist on zepto.calendar"),this;a=f.init}return a.apply(this,arguments)},a.fn.calendar.defaults={selectDate:(new Date).toDateString(),startDate:(new Date).toDateString(),rangeMonth:6,wday:0,title:"选择日期",language:{year:"年",month:"月",monthList:["1","2","3","4","5","6","7","8","9","10","11","12"],weekList:["日","一","二","三","四","五","六"]},selecteCallback:null},e});